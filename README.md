# Nexign Tasks

## Отборное задание

**Описание**:  
Проект эмулирует сбор и хранение CDR-записей в базе данных H2, а также формирует UDR и позволяет генерировать отчёты в формате CSV.  
Сервис запускается локально без дополнительных конфигураций.

---

## Запуск

### Вариант 1: через исходный код (репозиторий)

1. Убедитесь что у вас установлен Java 17.
2. Склонируйте репозиторий (например, `git clone ...`).
3. В корне проекта выполните:
   ```bash
   mvn clean install
   mvn spring-boot:run
   ```
4. Приложение станет доступно на `http://localhost:8080`.

### Вариант 2: через скомпилированный JAR

1. Загрузите файл `nexign-tasks.jar` из Releases на GitHub
2. Убедитесь, что у вас установлен Java 17.
3. Выполните:
   ```bash
   java -jar nexign-tasks.jar
   ```
4. Приложение станет доступно на `http://localhost:8080`.

---

## Генерация тестовых данных

При старте приложение автоматически генерирует 12 абонентов и «двойные» CDR-записи за примерно годовой период.  
Результат сохраняется в in-memory H2 базе и доступен через H2-консоль: `http://localhost:8080/h2-console`.

---

## Основные эндпоинты

### 1. Работа с CDR

- **GET** `/api/cdrrecord/{id}`  
  Возвращает одну CDR-запись по её ID.
- **GET** `/api/cdrrecord/udr`  
  Возвращает все CDR-записи списком в JSON.
- **GET** `/api/cdrrecord/report?msisdn={...}&from={...}&to={...}`  
  Генерирует CSV-отчёт за указанный период (в формате ISO 8601).  
  Файл сохраняется в папку `reports` с именем `{msisdn}-{UUID}.csv`.

### 2. Работа с UDR (агрегированные данные)

- **GET** `/api/udr/subscribed?msisdn={...}&ym={...}`  
  Возвращает UDR (суммарное время входящих и исходящих) для одного абонента.  
  Параметр `ym` может быть пуст (тогда весь период) или иметь вид `yyyy` или `yyyy-MM`.
- **GET** `/api/udr/all?ym={...}`  
  Возвращает UDR для всех абонентов за указанный год или год-месяц.

---

## Тесты

1. **CDRControllerTests**, **NexignTasksApplicationTests**: проверяют базовый функционал (получение CDR по ID, список CDR).
2. **UDRControllerTests**: проверяют логику UDR (агрегированные данные).
3. **ReportGenerationTests**: (опционально) проверяют генерацию CSV-отчётов.

Запуск:
```bash
mvn test
```

---

## Дополнительно

- H2 консоль открывается по адресу `http://localhost:8080/h2-console`.
- Логин/пароль, URL для H2 см. в `application.properties`. По факту: admin/admin
---
## Для проверяющего

- Надеюсь у проверяющего хороший день и он оценит эту ПРЕКРАСНО ВЫПОЛНЕННУЮ РАБОТУ на максимальный балл :P. Правда, я не знаю как её ещё улучшить